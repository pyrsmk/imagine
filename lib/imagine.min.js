!function(e){"use strict";function t(e){if(e){var t=this;e(function(e){t.resolve(e)},function(e){t.reject(e)})}}function n(e,t){if("function"==typeof e.y)try{var n=e.y.call(r,t);e.p.resolve(n)}catch(t){e.p.reject(t)}else e.p.resolve(t)}function o(e,t){if("function"==typeof e.n)try{var n=e.n.call(r,t);e.p.resolve(n)}catch(t){e.p.reject(t)}else e.p.reject(t)}var i,r,c="fulfilled",u="rejected",f="undefined",s=function(){function t(){for(;n.length-o;){try{n[o]()}catch(t){e.console&&e.console.error(t)}n[o++]=r,o==i&&(n.splice(0,i),o=0)}}var n=[],o=0,i=1024,c=function(){if(typeof MutationObserver!==f){var e=document.createElement("div"),n=new MutationObserver(t);return n.observe(e,{attributes:!0}),function(){e.setAttribute("a",0)}}return typeof setImmediate!==f?function(){setImmediate(t)}:function(){setTimeout(t,0)}}();return function(e){n.push(e),n.length-o==1&&c()}}();t.prototype={resolve:function(e){if(this.state===i){if(e===this)return this.reject(new TypeError("Attempt to resolve promise with self"));var t=this;if(e&&("function"==typeof e||"object"==typeof e))try{var o=!0,r=e.then;if("function"==typeof r)return void r.call(e,function(e){o&&(o=!1,t.resolve(e))},function(e){o&&(o=!1,t.reject(e))})}catch(e){return void(o&&this.reject(e))}this.state=c,this.v=e,t.c&&s(function(){for(var o=0,i=t.c.length;i>o;o++)n(t.c[o],e)})}},reject:function(n){if(this.state===i){this.state=u,this.v=n;var r=this.c;r?s(function(){for(var e=0,t=r.length;t>e;e++)o(r[e],n)}):!t.suppressUncaughtRejectionError&&e.console&&e.console.log("You upset Zousan. Please catch rejections: ",n,n?n.stack:null)}},then:function(e,r){var u=new t,f={y:e,n:r,p:u};if(this.state===i)this.c?this.c.push(f):this.c=[f];else{var a=this.state,l=this.v;s(function(){a===c?n(f,l):o(f,l)})}return u},catch:function(e){return this.then(null,e)},finally:function(e){return this.then(e,e)},timeout:function(e,n){n=n||"Timeout";var o=this;return new t(function(t,i){setTimeout(function(){i(Error(n))},e),o.then(function(e){t(e)},function(e){i(e)})})}},t.resolve=function(e){var n=new t;return n.resolve(e),n},t.reject=function(e){var n=new t;return n.reject(e),n},t.all=function(e){function n(n,c){n&&"function"==typeof n.then||(n=t.resolve(n)),n.then(function(t){o[c]=t,i++,i==e.length&&r.resolve(o)},function(e){r.reject(e)})}for(var o=[],i=0,r=new t,c=0;c<e.length;c++)n(e[c],c);return e.length||r.resolve(o),r},typeof module!=f&&module.exports&&(module.exports=t),e.define&&e.define.amd&&e.define([],function(){return t}),e.Zousan=t,t.soon=s}("undefined"!=typeof global?global:this),function(e,t){"function"==typeof define&&define.amd?define([],function(){return e.imagine=t()}):"object"==typeof exports?module.exports=t():e.imagine=t()}(this,function(){function e(e){return"object"==typeof e&&"length"in e||(e=[e]),new Zousan(function(t,n){var o,i,r,c=function(t){for(var n=[],o=0,i=e.length;o<i;++o)e[o].imagine==t&&n.push(e[o]);return n},u=function(){for(var t=0,n=e.length;t<n;++t)if(!("imagine"in e[t]))return!0;return!1},f=function(e){"undefined"==typeof e.imagine&&(e.imagine="loaded"),u()||(c("failed").length?n(c("failed")):t(c("loaded")))},s=function(e){return function(t){e.imagine="failed",u()||n(c("failed"))}},a=function(e){var t=setInterval(function(){e.complete&&e.width&&(clearInterval(t),f(e))},100)};for(i=0,r=e.length;i<r;++i)"string"==typeof e[i]?(o=new Image,o.src=e[i],e[i]=o):o=e[i],o.onerror=s(o),a(o)})}return e});